<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Интерактивный гид по развертыванию Srecha Invoice на Debian</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .progress-bar {
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 30px;
        }

        .progress {
            background: linear-gradient(90deg, #4CAF50, #45a049);
            height: 20px;
            border-radius: 5px;
            transition: width 0.3s ease;
            position: relative;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 12px;
        }

        .step {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: none;
            animation: slideIn 0.5s ease-out;
        }

        .step.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .step-number {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
            margin-right: 20px;
        }

        .step-title {
            font-size: 1.8em;
            color: #333;
        }

        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #f39c12;
        }

        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #28a745;
        }

        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #17a2b8;
        }

        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            margin: 15px 0;
            position: relative;
            overflow-x: auto;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #007acc;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .copy-btn:hover {
            background: #005a9e;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            transition: background 0.3s ease;
        }

        .checkbox-item:hover {
            background: #e9ecef;
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }

        .prerequisites {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .prereq-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #007acc;
        }

        .prereq-card h4 {
            color: #007acc;
            margin-bottom: 10px;
        }

        .command-explanation {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 3px solid #007acc;
        }

        .accordion {
            margin: 20px 0;
        }

        .accordion-header {
            background: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .accordion-header:hover {
            background: #dee2e6;
        }

        .accordion-content {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            display: none;
        }

        .accordion-content.active {
            display: block;
        }

        .troubleshooting {
            background: #fff5f5;
            border: 1px solid #fed7d7;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .troubleshooting h4 {
            color: #e53e3e;
            margin-bottom: 15px;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-pending { background: #ffc107; }
        .status-progress { background: #17a2b8; }
        .status-complete { background: #28a745; }

        .step-list {
            list-style: none;
            counter-reset: step-counter;
        }

        .step-list li {
            counter-increment: step-counter;
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            position: relative;
            padding-left: 60px;
        }

        .step-list li::before {
            content: counter(step-counter);
            position: absolute;
            left: 15px;
            top: 15px;
            background: #007acc;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .terminal-simulator {
            background: #1e1e1e;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            color: #00ff00;
            font-family: 'Consolas', 'Monaco', monospace;
            position: relative;
        }

        .terminal-header {
            background: #333;
            margin: -20px -20px 15px -20px;
            padding: 10px 20px;
            border-radius: 8px 8px 0 0;
            color: #ccc;
            font-size: 14px;
        }

        .blinking-cursor::after {
            content: '_';
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .tabs {
            display: flex;
            background: #e9ecef;
            border-radius: 8px 8px 0 0;
            margin-bottom: 0;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border-radius: 8px 8px 0 0;
            background: #e9ecef;
            border-bottom: 2px solid transparent;
        }

        .tab.active {
            background: white;
            border-bottom: 2px solid #007acc;
        }

        .tab-content {
            background: white;
            padding: 20px;
            border-radius: 0 0 8px 8px;
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .step {
                padding: 20px;
            }
            
            .navigation {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 Развертывание Srecha Invoice на Debian</h1>
            <p>Пошаговый интерактивный гид для начинающих</p>
        </div>

        <div class="progress-bar">
            <div class="progress" id="progressBar" style="width: 0%">
                <div class="progress-text" id="progressText">0 / 8</div>
            </div>
        </div>

        <!-- Шаг 0: Введение -->
        <div class="step active" id="step0">
            <div class="step-header">
                <div class="step-number">🏠</div>
                <div class="step-title">Добро пожаловать!</div>
            </div>
            
            <div class="info">
                <h4>📋 Что вы узнаете:</h4>
                <ul>
                    <li>Как подготовить Debian сервер</li>
                    <li>Как установить все необходимые компоненты</li>
                    <li>Как развернуть приложение без Docker</li>
                    <li>Как настроить SSL сертификаты</li>
                    <li>Как управлять системой</li>
                </ul>
            </div>

            <div class="warning">
                <h4>⚠️ Важно знать перед началом:</h4>
                <ul>
                    <li>Вам понадобится Debian 11+ сервер с правами root</li>
                    <li>Процесс займет примерно 30-60 минут</li>
                    <li>Убедитесь, что у вас есть доступ к серверу по SSH</li>
                    <li>Желательно иметь настроенный домен</li>
                </ul>
            </div>

            <div class="prerequisites">
                <div class="prereq-card">
                    <h4>🖥️ Сервер</h4>
                    <p><strong>ОС:</strong> Debian 11+ (Bullseye)</p>
                    <p><strong>RAM:</strong> минимум 2 ГБ</p>
                    <p><strong>CPU:</strong> 1+ ядро</p>
                    <p><strong>Диск:</strong> 20+ ГБ</p>
                </div>
                
                <div class="prereq-card">
                    <h4>🌐 Сеть</h4>
                    <p><strong>IP:</strong> статический IP-адрес</p>
                    <p><strong>Домен:</strong> настроенный DNS (опционально)</p>
                    <p><strong>Порты:</strong> 80, 443, 22</p>
                </div>
                
                <div class="prereq-card">
                    <h4>🔑 Доступ</h4>
                    <p><strong>SSH:</strong> доступ с правами root</p>
                    <p><strong>Пароли:</strong> будут сгенерированы автоматически</p>
                </div>
            </div>

            <div class="success">
                <h4>✅ Что будет установлено автоматически:</h4>
                <ul>
                    <li><strong>Node.js 18.x</strong> - JavaScript сервер</li>
                    <li><strong>PostgreSQL</strong> - база данных</li>
                    <li><strong>Nginx</strong> - веб-сервер</li>
                    <li><strong>Let's Encrypt</strong> - SSL сертификаты</li>
                    <li><strong>UFW Firewall</strong> - защита сервера</li>
                </ul>
            </div>
        </div>

        <!-- Шаг 1: Подключение к серверу -->
        <div class="step" id="step1">
            <div class="step-header">
                <div class="step-number">1</div>
                <div class="step-title">Подключение к серверу</div>
            </div>

            <p>Первым делом нужно подключиться к вашему Debian серверу через SSH.</p>

            <div class="tabs">
                <div class="tab active" onclick="showTab('windows-ssh')">Windows</div>
                <div class="tab" onclick="showTab('mac-ssh')">Mac/Linux</div>
            </div>

            <div class="tab-content active" id="windows-ssh">
                <h4>Для Windows:</h4>
                <p>Используйте <strong>PuTTY</strong> или встроенный терминал Windows:</p>
                
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Копировать</button>
ssh root@ВАШ_IP_АДРЕС
                </div>

                <div class="command-explanation">
                    <strong>Объяснение:</strong> Замените <code>ВАШ_IP_АДРЕС</code> на реальный IP вашего сервера. Например: <code>ssh root@192.168.1.100</code>
                </div>
            </div>

            <div class="tab-content" id="mac-ssh">
                <h4>Для Mac/Linux:</h4>
                <p>Откройте терминал и выполните:</p>
                
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Копировать</button>
ssh root@ВАШ_IP_АДРЕС
                </div>
            </div>

            <div class="terminal-simulator">
                <div class="terminal-header">root@debian-server:~</div>
                <div>$ ssh root@192.168.1.100</div>
                <div>The authenticity of host '192.168.1.100' can't be established.</div>
                <div>Are you sure you want to continue connecting (yes/no/[fingerprint])? <span style="color: #ffc107;">yes</span></div>
                <div>root@192.168.1.100's password: <span style="color: #ffc107;">***********</span></div>
                <div style="color: #28a745;">Welcome to Debian GNU/Linux 11 (bullseye)</div>
                <div>root@server:~# <span class="blinking-cursor"></span></div>
            </div>

            <div class="warning">
                <h4>🔒 Безопасность:</h4>
                <p>При первом подключении система может спросить о доверии к серверу. Введите <code>yes</code> для продолжения.</p>
            </div>

            <div class="accordion">
                <div class="accordion-header" onclick="toggleAccordion('ssh-troubleshooting')">
                    <span>🆘 Проблемы с подключением?</span>
                    <span>▼</span>
                </div>
                <div class="accordion-content" id="ssh-troubleshooting">
                    <div class="troubleshooting">
                        <h4>Частые проблемы:</h4>
                        <ul>
                            <li><strong>Connection refused:</strong> Проверьте IP адрес и убедитесь, что SSH сервис запущен</li>
                            <li><strong>Permission denied:</strong> Проверьте логин и пароль</li>
                            <li><strong>Network unreachable:</strong> Проверьте интернет соединение</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Шаг 2: Подготовка сервера -->
        <div class="step" id="step2">
            <div class="step-header">
                <div class="step-number">2</div>
                <div class="step-title">Подготовка сервера</div>
            </div>

            <p>Теперь нужно подготовить сервер: обновить систему и установить базовые пакеты.</p>

            <div class="info">
                <h4>📦 Что мы сделаем:</h4>
                <ul>
                    <li>Обновим список пакетов</li>
                    <li>Установим обновления безопасности</li>
                    <li>Установим необходимые утилиты</li>
                </ul>
            </div>

            <h4>Обновление системы:</h4>
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">Копировать</button>
apt update && apt upgrade -y
            </div>

            <div class="command-explanation">
                <strong>Объяснение:</strong>
                <ul>
                    <li><code>apt update</code> - обновляет список доступных пакетов</li>
                    <li><code>apt upgrade -y</code> - устанавливает все обновления автоматически</li>
                </ul>
            </div>

            <h4>Установка базовых утилит:</h4>
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">Копировать</button>
apt install -y curl wget git openssl ufw lsb-release
            </div>

            <div class="command-explanation">
                <strong>Что устанавливается:</strong>
                <ul>
                    <li><code>curl, wget</code> - утилиты для загрузки файлов</li>
                    <li><code>git</code> - система контроля версий</li>
                    <li><code>openssl</code> - инструменты шифрования</li>
                    <li><code>ufw</code> - простой firewall</li>
                    <li><code>lsb-release</code> - информация о системе</li>
                </ul>
            </div>

            <div class="terminal-simulator">
                <div class="terminal-header">root@debian-server:~</div>
                <div>root@server:~# apt update && apt upgrade -y</div>
                <div>Hit:1 http://deb.debian.org/debian bullseye InRelease</div>
                <div>Get:2 http://security.debian.org/debian-security bullseye-security InRelease</div>
                <div style="color: #28a745;">Reading package lists... Done</div>
                <div style="color: #28a745;">Building dependency tree... Done</div>
                <div>root@server:~# <span class="blinking-cursor"></span></div>
            </div>

            <div class="warning">
                <h4>⏱️ Время выполнения:</h4>
                <p>Обновление может занять 5-15 минут в зависимости от скорости интернета и количества обновлений.</p>
            </div>
        </div>

        <!-- Шаг 3: Загрузка проекта -->
        <div class="step" id="step3">
            <div class="step-header">
                <div class="step-number">3</div>
                <div class="step-title">Загрузка проекта</div>
            </div>

            <p>Теперь нужно загрузить код проекта на сервер. Есть несколько способов:</p>

            <div class="tabs">
                <div class="tab active" onclick="showTab('git-method')">Git (рекомендуется)</div>
                <div class="tab" onclick="showTab('upload-method')">Загрузка файлов</div>
            </div>

            <div class="tab-content active" id="git-method">
                <h4>Метод 1: Клонирование через Git</h4>
                <p>Если ваш проект находится в Git репозитории:</p>

                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Копировать</button>
git clone https://github.com/ВАШ_ПОЛЬЗОВАТЕЛЬ/srecha-invoice.git
cd srecha-invoice
                </div>

                <div class="command-explanation">
                    <strong>Замените:</strong> <code>ВАШ_ПОЛЬЗОВАТЕЛЬ</code> на ваш GitHub username или URL вашего репозитория.
                </div>
            </div>

            <div class="tab-content" id="upload-method">
                <h4>Метод 2: Загрузка файлов</h4>
                <p>Если у вас есть архив с проектом:</p>

                <ol class="step-list">
                    <li>Создайте директорию для проекта:
                        <div class="code-block">
mkdir -p /root/srecha-invoice
cd /root/srecha-invoice
                        </div>
                    </li>
                    <li>Загрузите файлы через SCP/SFTP или скачайте архив:
                        <div class="code-block">
wget https://ваш-сайт.com/srecha-invoice.zip
unzip srecha-invoice.zip
                        </div>
                    </li>
                </ol>
            </div>

            <div class="success">
                <h4>✅ Проверка загрузки:</h4>
                <p>Убедитесь, что файлы загружены правильно:</p>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Копировать</button>
ls -la
                </div>
                <p>Вы должны увидеть файлы: <code>deploy-without-docker.sh</code>, <code>server.js</code>, <code>package.json</code> и другие.</p>
            </div>

            <div class="info">
                <h4>📁 Структура проекта:</h4>
                <p>В директории должны быть следующие ключевые файлы:</p>
                <ul>
                    <li><code>deploy-without-docker.sh</code> - скрипт автоматического развертывания</li>
                    <li><code>setup-ssl.sh</code> - скрипт настройки SSL</li>
                    <li><code>server.js</code> - основной файл приложения</li>
                    <li><code>package.json</code> - зависимости Node.js</li>
                    <li><code>nginx.conf</code> - конфигурация веб-сервера</li>
                </ul>
            </div>
        </div>

        <!-- Шаг 4: Автоматическое развертывание -->
        <div class="step" id="step4">
            <div class="step-header">
                <div class="step-number">4</div>
                <div class="step-title">Автоматическое развертывание</div>
            </div>

            <p>Теперь самое интересное! Запустим автоматический скрипт развертывания, который сделает всё за нас.</p>

            <div class="warning">
                <h4>⚠️ Внимание!</h4>
                <p>Скрипт автоматически установит и настроит все компоненты. Процесс может занять 10-20 минут.</p>
            </div>

            <h4>Сначала сделаем скрипт исполняемым:</h4>
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">Копировать</button>
chmod +x deploy-without-docker.sh
            </div>

            <h4>Теперь запускаем развертывание:</h4>
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">Копировать</button>
./deploy-without-docker.sh
            </div>

            <div class="info">
                <h4>🔄 Что происходит автоматически:</h4>
                <ol class="step-list">
                    <li>Установка Node.js 18.x</li>
                    <li>Установка PostgreSQL базы данных</li>
                    <li>Установка Nginx веб-сервера</li>
                    <li>Создание пользователя системы 'srecha'</li>
                    <li>Настройка базы данных и пользователей</li>
                    <li>Настройка firewall (UFW)</li>
                    <li>Генерация безопасных паролей</li>
                    <li>Создание SSL сертификатов (самоподписанные)</li>
                    <li>Копирование файлов приложения</li>
                    <li>Установка зависимостей Node.js</li>
                    <li>Выполнение миграций базы данных</li>
                    <li>Настройка Nginx</li>
                    <li>Создание systemd сервиса</li>
                    <li>Настройка автоматического резервного копирования</li>
                </ol>
            </div>

            <div class="terminal-simulator">
                <div class="terminal-header">root@debian-server:~/srecha-invoice</div>
                <div>root@server:~/srecha-invoice# ./deploy-without-docker.sh</div>
                <div style="color: #28a745;">[2024-01-20 15:30:15] 🚀 Начало развертывания Srecha Invoice System (без Docker)</div>
                <div style="color: #28a745;">[2024-01-20 15:30:16] Операционная система: Debian GNU/Linux 11 (bullseye)</div>
                <div style="color: #28a745;">[2024-01-20 15:30:17] Обновление системы...</div>
                <div style="color: #28a745;">[2024-01-20 15:32:45] Установка Node.js...</div>
                <div style="color: #28a745;">[2024-01-20 15:34:12] Node.js установлен: v18.19.0</div>
                <div style="color: #28a745;">[2024-01-20 15:34:13] Установка PostgreSQL...</div>
                <div>...</div>
                <div style="color: #28a745;">[2024-01-20 15:48:30] 🎉 Развертывание завершено!</div>
                <div>root@server:~/srecha-invoice# <span class="blinking-cursor"></span></div>
            </div>

            <div class="success">
                <h4>✅ Признаки успешного завершения:</h4>
                <ul>
                    <li>Сообщение "🎉 Развертывание завершено!"</li>
                    <li>Информация о доступности приложения</li>
                    <li>Список полезных команд</li>
                    <li>Предупреждения о дальнейших действиях</li>
                </ul>
            </div>

            <div class="accordion">
                <div class="accordion-header" onclick="toggleAccordion('deploy-troubleshooting')">
                    <span>🆘 Что делать, если что-то пошло не так?</span>
                    <span>▼</span>
                </div>
                <div class="accordion-content" id="deploy-troubleshooting">
                    <div class="troubleshooting">
                        <h4>Частые проблемы:</h4>
                        <ul>
                            <li><strong>Ошибка "Permission denied":</strong> Убедитесь, что запускаете от root</li>
                            <li><strong>Ошибка сети:</strong> Проверьте интернет соединение</li>
                            <li><strong>Ошибка базы данных:</strong> Возможно, PostgreSQL уже установлен</li>
                            <li><strong>Скрипт остановился:</strong> Запустите заново - он продолжит с того места, где остановился</li>
                        </ul>
                        
                        <h4>Команды для диагностики:</h4>
                        <div class="code-block">
# Проверка статуса сервисов
systemctl status srecha-invoice nginx postgresql

# Просмотр логов
journalctl -u srecha-invoice --since "10 minutes ago"
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Шаг 5: Настройка SSL -->
        <div class="step" id="step5">
            <div class="step-header">
                <div class="step-number">5</div>
                <div class="step-title">Настройка SSL сертификатов</div>
            </div>

            <p>После развертывания у вас есть самоподписанные SSL сертификаты. Для продакшена лучше получить настоящие от Let's Encrypt.</p>

            <div class="warning">
                <h4>⚠️ Требования для Let's Encrypt:</h4>
                <ul>
                    <li>У вас должен быть настроенный домен</li>
                    <li>Домен должен указывать на IP вашего сервера</li>
                    <li>Порты 80 и 443 должны быть доступны из интернета</li>
                </ul>
            </div>

            <div class="tabs">
                <div class="tab active" onclick="showTab('with-domain')">У меня есть домен</div>
                <div class="tab" onclick="showTab('no-domain')">У меня нет домена</div>
            </div>

            <div class="tab-content active" id="with-domain">
                <h4>Настройка с собственным доменом:</h4>
                
                <div class="info">
                    <h4>📋 Подготовка:</h4>
                    <ol>
                        <li>Убедитесь, что ваш домен указывает на IP сервера</li>
                        <li>Проверьте доступность: <code>ping ваш-домен.com</code></li>
                    </ol>
                </div>

                <p>Запустите скрипт настройки SSL:</p>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Копировать</button>
chmod +x setup-ssl.sh
./setup-ssl.sh
                </div>

                <p>Скрипт попросит ввести:</p>
                <ul>
                    <li><strong>Домен:</strong> например, <code>invoice.mycompany.com</code></li>
                    <li><strong>Email:</strong> для уведомлений об истечении сертификата</li>
                </ul>

                <div class="terminal-simulator">
                    <div class="terminal-header">root@debian-server:~/srecha-invoice</div>
                    <div>root@server:~/srecha-invoice# ./setup-ssl.sh</div>
                    <div>Введите ваш домен (например, example.com): <span style="color: #ffc107;">invoice.mycompany.com</span></div>
                    <div>Введите ваш email: <span style="color: #ffc107;">admin@mycompany.com</span></div>
                    <div style="color: #28a745;">[2024-01-20 16:05:15] Настройка SSL сертификата для домена: invoice.mycompany.com</div>
                    <div>Saving debug log to /var/log/letsencrypt/letsencrypt.log</div>
                    <div style="color: #28a745;">Successfully received certificate.</div>
                    <div style="color: #28a745;">✅ SSL сертификат настроен успешно!</div>
                </div>
            </div>

            <div class="tab-content" id="no-domain">
                <h4>Работа без домена (самоподписанные сертификаты):</h4>
                
                <div class="info">
                    <p>Если у вас нет домена, система уже настроена с самоподписанными сертификатами. Приложение доступно по IP адресу, но браузер будет показывать предупреждение о безопасности.</p>
                </div>

                <div class="warning">
                    <h4>🔒 Предупреждение браузера:</h4>
                    <p>При первом заходе браузер покажет предупреждение "Ваше соединение не защищено". Нажмите "Дополнительно" → "Перейти на сайт" для продолжения.</p>
                </div>

                <p>Приложение будет доступно по адресу:</p>
                <div class="code-block">
https://ВАШ_IP_АДРЕС
                </div>
            </div>

            <div class="success">
                <h4>✅ Проверка SSL:</h4>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Копировать</button>
# Проверка сертификата
openssl x509 -in /opt/srecha/ssl/fullchain.pem -text -noout

# Проверка через curl
curl -I https://ваш-домен.com
                </div>
            </div>
        </div>

        <!-- Шаг 6: Проверка работы -->
        <div class="step" id="step6">
            <div class="step-header">
                <div class="step-number">6</div>
                <div class="step-title">Проверка работы системы</div>
            </div>

            <p>Теперь давайте убедимся, что всё работает правильно!</p>

            <div class="info">
                <h4>🔍 Что проверяем:</h4>
                <ul>
                    <li>Статус всех сервисов</li>
                    <li>Доступность API</li>
                    <li>Работу веб-интерфейса</li>
                    <li>Подключение к базе данных</li>
                </ul>
            </div>

            <h4>1. Проверка статуса сервисов:</h4>
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">Копировать</button>
systemctl status srecha-invoice nginx postgresql
            </div>

            <div class="command-explanation">
                <strong>Ожидаемый результат:</strong> Все три сервиса должны показывать статус <span style="color: #28a745;">"active (running)"</span>
            </div>

            <h4>2. Проверка API:</h4>
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">Копировать</button>
curl http://localhost:3000/health
            </div>

            <div class="command-explanation">
                <strong>Ожидаемый ответ:</strong> <code>{"status":"OK","timestamp":"...","environment":"production"}</code>
            </div>

            <h4>3. Проверка веб-интерфейса:</h4>
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">Копировать</button>
curl -I https://ваш-домен.com
# или если без домена:
curl -I -k https://ВАШ_IP_АДРЕС
            </div>

            <div class="terminal-simulator">
                <div class="terminal-header">root@debian-server:~</div>
                <div>root@server:~# systemctl status srecha-invoice</div>
                <div style="color: #28a745;">● srecha-invoice.service - Srecha Invoice System - Node.js Backend</div>
                <div style="color: #28a745;">   Loaded: loaded (/etc/systemd/system/srecha-invoice.service; enabled; vendor preset: enabled)</div>
                <div style="color: #28a745;">   Active: active (running) since Sat 2024-01-20 16:10:30 UTC; 5min ago</div>
                <div>root@server:~# curl http://localhost:3000/health</div>
                <div style="color: #28a745;">{"status":"OK","timestamp":"2024-01-20T16:15:45.123Z","environment":"production"}</div>
            </div>

            <div class="success">
                <h4>✅ Признаки успешной работы:</h4>
                <ul>
                    <li><span class="status-indicator status-complete"></span>Все сервисы в статусе "active (running)"</li>
                    <li><span class="status-indicator status-complete"></span>API отвечает на запросы health check</li>
                    <li><span class="status-indicator status-complete"></span>Веб-интерфейс загружается</li>
                    <li><span class="status-indicator status-complete"></span>HTTPS работает без ошибок</li>
                </ul>
            </div>

            <h4>4. Проверка логов (если что-то не работает):</h4>
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">Копировать</button>
# Логи приложения
journalctl -u srecha-invoice -f

# Логи Nginx
tail -f /var/log/nginx/error.log

# Логи PostgreSQL
tail -f /var/log/postgresql/*.log
            </div>

            <div class="accordion">
                <div class="accordion-header" onclick="toggleAccordion('status-troubleshooting')">
                    <span>🆘 Что делать, если что-то не работает?</span>
                    <span>▼</span>
                </div>
                <div class="accordion-content" id="status-troubleshooting">
                    <div class="troubleshooting">
                        <h4>Проблема: Сервис не запущен</h4>
                        <div class="code-block">
# Попробуйте перезапустить
systemctl restart srecha-invoice

# Если не помогает, проверьте логи
journalctl -u srecha-invoice --since "5 minutes ago"
                        </div>

                        <h4>Проблема: API не отвечает</h4>
                        <div class="code-block">
# Проверьте, запущен ли процесс Node.js
ps aux | grep node

# Проверьте порт 3000
netstat -tlnp | grep :3000
                        </div>

                        <h4>Проблема: Сайт недоступен</h4>
                        <div class="code-block">
# Проверьте Nginx
nginx -t
systemctl status nginx

# Проверьте firewall
ufw status
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Шаг 7: Первый вход -->
        <div class="step" id="step7">
            <div class="step-header">
                <div class="step-number">7</div>
                <div class="step-title">Первый вход в систему</div>
            </div>

            <p>Отлично! Система работает. Теперь давайте зайдем в веб-интерфейс и настроим административный доступ.</p>

            <div class="success">
                <h4>🌐 Откройте в браузере:</h4>
                <div class="code-block">
https://ваш-домен.com
# или если без домена:
https://ВАШ_IP_АДРЕС
                </div>
            </div>

            <div class="warning">
                <h4>🔒 Если используете самоподписанные сертификаты:</h4>
                <ol>
                    <li>Браузер покажет предупреждение "Ваше соединение не защищено"</li>
                    <li>Нажмите "Дополнительно"</li>
                    <li>Выберите "Перейти на сайт (небезопасно)"</li>
                    <li>Это нормально для самоподписанных сертификатов</li>
                </ol>
            </div>

            <div class="info">
                <h4>👤 Первоначальная настройка:</h4>
                <p>При первом запуске система может потребовать:</p>
                <ul>
                    <li>Создание администратора</li>
                    <li>Настройку базовых параметров</li>
                    <li>Выбор языка интерфейса</li>
                </ul>
            </div>

            <h4>Проверка данных для подключения:</h4>
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">Копировать</button>
# Посмотреть сгенерированные пароли
cat /opt/srecha/app/.env | grep PASSWORD
            </div>

            <div class="success">
                <h4>✅ Система готова к работе!</h4>
                <p>Если вы видите интерфейс приложения, поздравляем! Развертывание прошло успешно.</p>
            </div>

            <div class="info">
                <h4>📋 Важные пути и файлы:</h4>
                <ul>
                    <li><strong>Конфигурация:</strong> <code>/opt/srecha/app/.env</code></li>
                    <li><strong>Логи:</strong> <code>/opt/srecha/logs/</code></li>
                    <li><strong>Загрузки:</strong> <code>/opt/srecha/uploads/</code></li>
                    <li><strong>Резервные копии:</strong> <code>/opt/srecha/backups/</code></li>
                </ul>
            </div>
        </div>

        <!-- Шаг 8: Управление системой -->
        <div class="step" id="step8">
            <div class="step-header">
                <div class="step-number">8</div>
                <div class="step-title">Управление системой</div>
            </div>

            <p>Теперь вы знаете, как управлять вашей системой в ежедневной работе!</p>

            <div class="tabs">
                <div class="tab active" onclick="showTab('daily-commands')">Ежедневные команды</div>
                <div class="tab" onclick="showTab('maintenance')">Обслуживание</div>
                <div class="tab" onclick="showTab('backup-restore')">Резервные копии</div>
            </div>

            <div class="tab-content active" id="daily-commands">
                <h4>🔄 Основные команды управления:</h4>
                
                <div class="accordion">
                    <div class="accordion-header" onclick="toggleAccordion('service-control')">
                        <span>Управление сервисами</span>
                        <span>▼</span>
                    </div>
                    <div class="accordion-content" id="service-control">
                        <div class="code-block">
# Статус сервиса
systemctl status srecha-invoice

# Запуск/остановка/перезапуск
systemctl start srecha-invoice
systemctl stop srecha-invoice
systemctl restart srecha-invoice

# Автозапуск (включить/отключить)
systemctl enable srecha-invoice
systemctl disable srecha-invoice
                        </div>
                    </div>
                </div>

                <div class="accordion">
                    <div class="accordion-header" onclick="toggleAccordion('log-viewing')">
                        <span>Просмотр логов</span>
                        <span>▼</span>
                    </div>
                    <div class="accordion-content" id="log-viewing">
                        <div class="code-block">
# Логи в реальном времени
journalctl -u srecha-invoice -f

# Последние 50 строк
journalctl -u srecha-invoice -n 50

# Логи за последний час
journalctl -u srecha-invoice --since "1 hour ago"

# Логи Nginx
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log
                        </div>
                    </div>
                </div>

                <div class="accordion">
                    <div class="accordion-header" onclick="toggleAccordion('monitoring')">
                        <span>Мониторинг ресурсов</span>
                        <span>▼</span>
                    </div>
                    <div class="accordion-content" id="monitoring">
                        <div class="code-block">
# Использование диска
df -h
du -sh /opt/srecha/*

# Активные процессы
ps aux | grep -E "node|nginx|postgres"

# Сетевые подключения
netstat -tlnp | grep -E ":80|:443|:3000|:5432"

# Общий статус системы
systemctl status srecha-invoice nginx postgresql
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="maintenance">
                <h4>🔧 Регулярное обслуживание:</h4>

                <div class="accordion">
                    <div class="accordion-header" onclick="toggleAccordion('updates')">
                        <span>Обновления системы</span>
                        <span>▼</span>
                    </div>
                    <div class="accordion-content" id="updates">
                        <div class="code-block">
# Обновление системных пакетов
apt update && apt upgrade -y

# Обновление приложения
cd /opt/srecha/app
systemctl stop srecha-invoice
git pull origin main
sudo -u srecha npm install --production
sudo -u srecha npm run migrate
systemctl start srecha-invoice
                        </div>
                    </div>
                </div>

                <div class="accordion">
                    <div class="accordion-header" onclick="toggleAccordion('ssl-renewal')">
                        <span>Обновление SSL сертификатов</span>
                        <span>▼</span>
                    </div>
                    <div class="accordion-content" id="ssl-renewal">
                        <div class="code-block">
# Ручное обновление Let's Encrypt
/opt/srecha/renew-ssl.sh

# Проверка автоматического обновления
crontab -l | grep renew-ssl

# Проверка срока действия
openssl x509 -in /opt/srecha/ssl/fullchain.pem -checkend 2592000
                        </div>
                    </div>
                </div>

                <div class="accordion">
                    <div class="accordion-header" onclick="toggleAccordion('log-cleanup')">
                        <span>Очистка логов</span>
                        <span>▼</span>
                    </div>
                    <div class="accordion-content" id="log-cleanup">
                        <div class="code-block">
# Очистка systemd логов (старше 7 дней)
journalctl --vacuum-time=7d

# Очистка логов Nginx (осторожно!)
sudo truncate -s 0 /var/log/nginx/*.log

# Удаление старых резервных копий (старше 30 дней)
find /opt/srecha/backups -name "*.tar.gz" -mtime +30 -delete
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="backup-restore">
                <h4>💾 Работа с резервными копиями:</h4>

                <div class="success">
                    <h4>✅ Автоматическое резервное копирование:</h4>
                    <p>Система автоматически создает резервные копии каждый день в 2:00 утра.</p>
                </div>

                <div class="accordion">
                    <div class="accordion-header" onclick="toggleAccordion('manual-backup')">
                        <span>Ручное создание резервной копии</span>
                        <span>▼</span>
                    </div>
                    <div class="accordion-content" id="manual-backup">
                        <div class="code-block">
# Создать резервную копию сейчас
/opt/srecha/backup.sh

# Посмотреть список резервных копий
ls -la /opt/srecha/backups/

# Проверить расписание автоматических копий
crontab -l
                        </div>
                    </div>
                </div>

                <div class="accordion">
                    <div class="accordion-header" onclick="toggleAccordion('restore-process')">
                        <span>Восстановление из резервной копии</span>
                        <span>▼</span>
                    </div>
                    <div class="accordion-content" id="restore-process">
                        <div class="warning">
                            <h4>⚠️ Осторожно!</h4>
                            <p>Восстановление перезапишет текущие данные. Сделайте копию перед восстановлением!</p>
                        </div>
                        <div class="code-block">
# 1. Остановить сервис
systemctl stop srecha-invoice

# 2. Распаковать резервную копию
cd /opt/srecha/backups
tar -xzf srecha_backup_YYYYMMDD_HHMMSS.tar.gz

# 3. Восстановить файлы
cp -r opt/srecha/uploads/* /opt/srecha/uploads/
cp opt/srecha/app/.env /opt/srecha/app/

# 4. Восстановить базу данных
sudo -u postgres dropdb srecha_invoice
sudo -u postgres createdb srecha_invoice -O srecha
sudo -u postgres psql srecha_invoice < database_backup.sql

# 5. Запустить сервис
systemctl start srecha-invoice
                        </div>
                    </div>
                </div>
            </div>

            <div class="warning">
                <h4>🚨 Экстренные контакты:</h4>
                <p>Сохраните эти команды для экстренных случаев:</p>
                <div class="code-block">
# Быстрая диагностика
systemctl status srecha-invoice nginx postgresql
curl http://localhost:3000/health

# Экстренный перезапуск всего
systemctl restart srecha-invoice nginx postgresql

# Создание диагностического отчета
journalctl -u srecha-invoice --since "1 hour ago" > /tmp/diagnostic.txt
                </div>
            </div>

            <div class="success">
                <h4>🎉 Поздравляем!</h4>
                <p>Вы успешно развернули Srecha Invoice System на Debian сервере без использования Docker!</p>
                <p>Система готова к работе и настроена для надежной эксплуатации.</p>
            </div>
        </div>

        <!-- Навигация -->
        <div class="navigation">
            <button class="btn btn-secondary" id="prevBtn" onclick="changeStep(-1)" disabled>← Назад</button>
            <div>
                <span id="stepIndicator">Шаг 1 из 8</span>
            </div>
            <button class="btn" id="nextBtn" onclick="changeStep(1)">Далее →</button>
        </div>
    </div>

    <script>
        let currentStep = 0;
        const totalSteps = 9; // 0-8

        function updateProgress() {
            const progress = (currentStep / (totalSteps - 1)) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').textContent = `${currentStep} / ${totalSteps - 1}`;
        }

        function showStep(step) {
            // Скрыть все шаги
            const steps = document.querySelectorAll('.step');
            steps.forEach(s => s.classList.remove('active'));
            
            // Показать текущий шаг
            document.getElementById('step' + step).classList.add('active');
            
            // Обновить навигацию
            document.getElementById('prevBtn').disabled = step === 0;
            document.getElementById('nextBtn').disabled = step === totalSteps - 1;
            
            // Обновить индикатор
            if (step === 0) {
                document.getElementById('stepIndicator').textContent = 'Введение';
            } else {
                document.getElementById('stepIndicator').textContent = `Шаг ${step} из ${totalSteps - 1}`;
            }
            
            if (step === totalSteps - 1) {
                document.getElementById('nextBtn').textContent = '🏁 Завершить';
            } else {
                document.getElementById('nextBtn').textContent = 'Далее →';
            }
        }

        function changeStep(direction) {
            const newStep = currentStep + direction;
            if (newStep >= 0 && newStep < totalSteps) {
                currentStep = newStep;
                showStep(currentStep);
                updateProgress();
                
                // Прокрутить к началу
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function copyCode(button) {
            const codeBlock = button.parentElement;
            const code = codeBlock.textContent.replace('Копировать', '').trim();
            
            navigator.clipboard.writeText(code).then(() => {
                const originalText = button.textContent;
                button.textContent = 'Скопировано!';
                button.style.background = '#28a745';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '#007acc';
                }, 2000);
            });
        }

        function showTab(tabId) {
            // Скрыть все вкладки
            const tabContents = document.querySelectorAll('.tab-content');
            const tabs = document.querySelectorAll('.tab');
            
            tabContents.forEach(tc => tc.classList.remove('active'));
            tabs.forEach(t => t.classList.remove('active'));
            
            // Показать выбранную вкладку
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }

        function toggleAccordion(id) {
            const content = document.getElementById(id);
            const header = content.previousElementSibling;
            const arrow = header.querySelector('span:last-child');
            
            if (content.classList.contains('active')) {
                content.classList.remove('active');
                arrow.textContent = '▼';
            } else {
                content.classList.add('active');
                arrow.textContent = '▲';
            }
        }

        // Инициализация
        showStep(0);
        updateProgress();

        // Обработка клавиш
        document.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowLeft') changeStep(-1);
            if (e.key === 'ArrowRight') changeStep(1);
        });
    </script>
</body>
</html>
